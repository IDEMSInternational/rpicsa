% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/get_spells_data.R
\name{get_spells_data}
\alias{get_spells_data}
\title{Get Spells Data}
\usage{
get_spells_data(
  data,
  date_time = NULL,
  year = NULL,
  station = NULL,
  element,
  doy = NULL,
  summary_data = NULL,
  day_from = 1,
  day_to = 366,
  s_start_month = 1,
  direction = c("greater", "less", "between", "outer"),
  value = 0.85,
  lb_value = 0,
  return_max_spell = TRUE,
  return_all_spells = FALSE,
  data_book = data_book
)
}
\arguments{
\item{data}{A data frame or data-frame name in \code{data_book} containing daily data.}

\item{date_time}{Name of the date column in \code{data}.}

\item{year}{Name of the year column in \code{data}. If \code{NULL}, a year is computed
from \code{date_time}, adjusted by \code{s_start_month}.}

\item{station}{Name of the station column in \code{data}. Default \code{NULL}.}

\item{element}{Name of the climatic variable to evaluate (e.g., \code{"rain"}).}

\item{doy}{Name of day-of-year column. If \code{NULL}, generated from \code{date_time}.}

\item{summary_data}{Optional. Name of the summary data frame in \code{data_book}
that contains start/end-of-season columns (e.g. \code{"start_rain"}, \code{"end_rains"}).}

\item{day_from}{Column name in \code{summary_data} or numeric value defining the
first day of the period to evaluate spells.}

\item{day_to}{Column name in \code{summary_data} or numeric value defining the
last day of the period to evaluate spells.}

\item{s_start_month}{Integer month (1–12) defining the “statistical year”
start for converting dates to year or DOY. Default \code{1} (January).}

\item{direction}{One of \code{"greater"}, \code{"less"}, \code{"between"}, or \code{"outer"}.}

\item{value}{Numeric threshold. If \code{direction = "between"} or \code{"outer"}, this is the upper bound.}

\item{lb_value}{Numeric lower bound if \code{direction = "between"} or \code{"outer"}.}

\item{return_max_spell}{Logical (default \code{TRUE}). Return longest spell per year/station.}

\item{return_all_spells}{Logical (default \code{FALSE}). Return table of all spells.}

\item{data_book}{The \code{DataBook} (R6) object storing input and output data.}
}
\value{
Data frame containing spells data
}
\description{
Identify and summarise spells of days meeting a rainfall (or other climatic)
condition over a given seasonal window.
}
\details{
A "spell" is a sequence of consecutive days where a condition holds. For
example, if rainfall >= 0.85 mm is considered a wet day, then a spell of
dry days is a sequence of days where rainfall < 0.85 mm.

Spells can be defined using a \emph{greater}, \emph{less}, \emph{between}, or \emph{outer}
threshold rule, e.g.:
\itemize{
\item \code{direction = "greater"} + \code{value = 10}: Here, a wet day is defined where rainfall >= 10.
This function then calculates the longest number of dry days (rain < 10) by year and station.
}
}
\examples{
# Example: Get the length of the longest spell between day 1 and 366 in the data
library(databook)
data_book <- DataBook$new()
daily_data <- rpicsa::daily_niger |>
  dplyr::filter(year > 1945, year <= 1950, station_name == "Agades") |>
  dplyr::mutate(year = as.numeric(year))
data_book$import_data(list(daily_data = daily_data))

get_spells_data(data = "daily_data",
                date_time = "date",
                year = "year",
                station = "station_name",
                element = "rain",
                doy = "doy", 
                day_from = 365,
                day_to = 366,
                direction = "less",
                value = 0.85,
                return_all_spells = TRUE,
                return_max_spell = TRUE,
                data_book = data_book)
data_book$get_data_frame("daily_data_by_station_name_year")
data_book$get_data_frame("spells_filter")

# Example 2: Compute start/end for daily_niger, then we can use that to get the spells
library(databook)
data_book <- DataBook$new()
daily_data <- rpicsa::daily_niger |>
  dplyr::filter(year > 1945, year <= 1950, station_name == "Agades") |>
  dplyr::mutate(year = as.numeric(year))
data_book$import_data(list(daily_data = daily_data))

start_rains(
  data = "daily_data", date_time = "date", station = "station_name",
  year = "year", rain = "rain", start_day = 121, end_day = 300,
  output = c("doy", "status"), data_book = data_book
)

end_rains(
  data = "daily_data", date_time = "date", station = "station_name",
  year = "year", rain = "rain", start_day = 121, end_day = 300,
  output = c("doy", "status"), data_book = data_book
)

# Get the spells from the start to end of rains
get_spells_data(data = "daily_data",
                date_time = "date",
                year = "year",
                station = "station_name",
                element = "rain",
                doy = "doy", 
                summary_data = "daily_data_by_station_name_year",
                day_from = "start_rain",
                day_to = "end_rains",
                direction = "less",
                value = 0.85,
                return_all_spells = TRUE,
                return_max_spell = TRUE,
                data_book = data_book)
data_book$get_data_frame("daily_data_by_station_name_year")
data_book$get_data_frame("spells_filter")

}
